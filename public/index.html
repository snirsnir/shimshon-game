<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משחק יעילות מר פנחס נחליאלי</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .computer-icon {
            font-size: 60px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: inline-block;
        }
        
        .computer-icon:hover {
            transform: scale(1.1);
        }
        
        .intro-screen {
            padding: 40px;
            text-align: center;
        }
        
        .game-screen {
            display: none;
            padding: 40px;
        }
        
        .character-intro {
            background: #f8f9fa;
            border-right: 5px solid #ff6b6b;
            padding: 30px;
            margin: 20px 0;
            border-radius: 10px;
        }
        
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .task-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .task-card:hover:not(.completed):not(.failed) {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .task-card.completed {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            cursor: default;
        }
        
        .task-card.failed {
            background: linear-gradient(135deg, #fc466b 0%, #ff4757 100%);
            opacity: 0.7;
            cursor: default;
        }
        
        .task-card h4 {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .task-card p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            margin: 3% auto;
            padding: 30px;
            width: 90%;
            max-width: 700px;
            border-radius: 20px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .timer {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .timer.warning {
            color: #ff4757;
            background: #ffe3e3;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .answer-area {
            margin: 25px 0;
        }
        
        .answer-area label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        
        .answer-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        .answer-input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 8px;
            font-weight: bold;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }
        
        .btn-large {
            padding: 20px 40px;
            font-size: 18px;
        }
        
        .result {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            line-height: 1.5;
        }
        
        .result.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .result.failure {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .close {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close:hover {
            color: #fff;
            background: #ff4757;
        }
        
        .progress {
            margin: 30px 0;
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }
        
        .progress-text {
            font-size: 20px;
            margin-bottom: 15px;
            font-weight: bold;
            color: #333;
        }
        
        .emoji-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .emoji {
            font-size: 2.5em;
            transition: transform 0.3s ease;
        }
        
        .emoji:hover {
            transform: scale(1.2);
        }
        
        .server-status {
            position: fixed;
            top: 15px;
            left: 15px;
            background: #28a745;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            z-index: 1001;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .server-status.offline {
            background: #dc3545;
            animation: pulse 2s infinite;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        .rules-box {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }
        
        .rules-box h4 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .rules-box ul {
            text-align: right;
            color: #856404;
        }
        
        .rules-box li {
            margin-bottom: 8px;
            padding-right: 10px;
        }

        .task-description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-right: 4px solid #667eea;
            margin: 20px 0;
            line-height: 1.6;
        }

        .button-group {
            text-align: center;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10px auto;
                padding: 20px;
            }
            
            .tasks-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .answer-input {
                min-height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="server-status" id="serverStatus">🔌 בודק חיבור...</div>
    
    <div class="container">
        <div class="header">
            <div class="computer-icon" onclick="startGame()">💻</div>
            <h1>מרכז מדעי טכנולוגי שמשון</h1>
            <p>מערכת ניהול משימות חכמה עם AI</p>
            <p style="font-size: 14px; opacity: 0.8; margin-top: 10px;">לחץ על המחשב כדי להתחיל!</p>
        </div>
        
        <div class="intro-screen" id="intro">
            <h2>ברוכים הבאים למשרד הכאוס הרשמי! 📋💀</h2>
            
            <div class="character-intro">
                <h3>🤵 הכירו את מר פנחס נחליאלי</h3>
                <p><strong>תפקיד:</strong> מנהל מחלקת "ניהול מורכבויות וסידור אי-סדרים" (מח"מס)</p>
                <p><strong>וותק:</strong> 47 שנה במערכת החינוך (התחיל כשהמחשבים היו בגודל של חדר שלם)</p>
                <p><strong>מצב נוכחי:</strong> טובע ב-847 משימות שונות שהצטברו מאז שנת 1987</p>
                <p><strong>האתגר הגדול:</strong> פנחס מסרב להשתמש ב-AI כי הוא חושב שזה "קסם שחור מהעתיד שיחליף אותו"</p>
                <p><strong>המשימה שלכם:</strong> לעזור לו להבין שAI יכול לחסוך לו המון זמן ולהפוך אותו ליעיל יותר!</p>
            </div>
            
            <div class="rules-box">
                <h4>📝 חוקי המשחק - איך נעזור למר פנחס:</h4>
                <ul>
                    <li>🕐 לכל משימה יש בדיוק 4 דקות - כמו בעבודה אמיתית!</li>
                    <li>🧠 צריך לתת תשובה הגיונית, מעשית וממוקדת</li>
                    <li>🤖 AI אמיתי יבדוק את התשובה שלכם ויחליט אם פנחס שוכנע</li>
                    <li>✅ אם התשובה טובה - מר פנחס יתחיל להבין את הערך של AI!</li>
                    <li>❌ אם לא - הוא ימשיך להתלונן ולהתנגד לטכנולוגיה...</li>
                    <li>🎯 המטרה: לגרום לפנחס להפוך למאמין ב-AI!</li>
                </ul>
            </div>
            
            <button class="btn btn-large" onclick="showTasks()">🚀 עזרו לפנחס! בואו נתחיל!</button>
        </div>
        
        <div class="game-screen" id="gameScreen">
            <div class="character-intro">
                <h3>💼 מר פנחס נחליאלי מחכה בקוצר רוח לעזרתכם!</h3>
                <p style="font-style: italic; font-size: 16px; color: #666;">
                    <em>"אוי ואבוי לי! יש לי כל כך הרבה דברים לעשות ואני פשוט לא מספיק! 
                    אתם בטח חושבים שהמחשב הזה והAI יעזרו לי, אבל איך זה יכול לדעת מה אני באמת צריך? 
                    זה בטח רק יסבך לי את החיים עוד יותר... אבל בואו ננסה, מה יש לי להפסיד?"</em>
                </p>
            </div>
            
            <div class="progress">
                <div class="progress-text">
                    התקדמות: <span id="completedTasks">0</span> מתוך <span id="totalTasks">17</span> משימות הושלמו
                </div>
                <div class="emoji-bar">
                    <span class="emoji" title="מר פנחס מתוסכל">😫</span>
                    <span class="emoji" title="מר פנחס מתחיל להסתקרן">😐</span>
                    <span class="emoji" title="מר פנחס מרוצה">😊</span>
                    <span class="emoji" title="מר פנחס מאמין ב-AI!">🎉</span>
                </div>
            </div>
            
            <div class="tasks-grid" id="tasksGrid">
                <!-- המשימות יווצרו כאן דינמית -->
            </div>
        </div>
    </div>
    
    <!-- Modal למשימות -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()" title="סגור">&times;</span>
            <h3 id="taskTitle" style="color: #667eea; margin-bottom: 15px;"></h3>
            
            <div class="timer" id="timer">⏰ זמן נותר: 4:00</div>
            
            <div class="task-description">
                <p id="taskDescription"></p>
            </div>
            
            <div class="answer-area">
                <label for="answerInput">💭 התשובה שלכם (כתבו בפירוט!):</label>
                <textarea 
                    id="answerInput" 
                    class="answer-input" 
                    placeholder="כתבו כאן את התשובה המפורטת שלכם... מר פנחס זקוק לפרטים כדי להבין איך AI יכול לעזור לו במשימה הזו!"
                ></textarea>
            </div>
            
            <div class="button-group">
                <button class="btn" id="checkBtn" onclick="checkAnswer()">
                    🔍 בדוק תשובה עם AI
                </button>
                <button class="btn btn-danger" onclick="closeModal()">
                    ❌ ביטול
                </button>
            </div>
            
            <div id="result"></div>
        </div>
    </div>

    <script>
        // 🎯 נתוני המשימות
        const tasks = [
            {
                id: 'emails',
                title: '📧 ניהול מיילים',
                description: 'מר פנחס קיבל 47 מיילים השבוע ולא יודע איך להתמודד איתם. כתבו מייל מנומס למנהל בנושא בקשה לחופשה בשבוע הבא. המייל חייב לכלול: נימוק ברור, תאריכים מדויקים, והצעה מעשית לכיסוי העבודה במהלך החופשה.',
                criteria: 'התשובה צריכה לכלול: פנייה מנומסת, תאריכים ברורים, נימוק לחופשה, והצעה לכיסוי העבודה'
            },
            {
                id: 'proposals',
                title: '📝 כתיבת הצעות מחיר',
                description: 'בית הספר צריך ציוד חדש והמנהל ביקש מפנחס לכתוב הצעה מפורטת. כתבו הצעה מקצועית לאספקת ציוד משרדי לבית הספר. כלול לפחות 8 פריטים שונים עם מחירים הגיוניים.',
                criteria: 'התשובה צריכה לכלול: רשימת פריטים ברורה, מחירים הגיוניים, סכום כולל'
            },
            {
                id: 'reports',
                title: '📊 יצירת דוחות נתונים',
                description: 'פנחס צריך להכין דוח חודשי מפורט על נוכחות התלמידים. צרו דוח קצר עם 3 ממצאים עיקריים על בסיס הנתונים הבאים: 85% נוכחות ממוצעת, 23 תלמידים עם יותר מ-5 חיסורים, ו-12 תלמידים עם נוכחות מושלמת.',
                criteria: 'התשובה צריכה לכלול: 3 ממצאים ברורים, ניתוח של הנתונים, המלצה לפעולה'
            },
            {
                id: 'logistics',
                title: '🚛 לוגיסטיקה ותפעול חירום',
                description: 'פתאום נשמעת אזעקת שריפה! פנחס צריך לתכנן פינוי חירום של 200 תלמידים מהבניין תוך 5 דקות בלבד. תכננו תהליך פינוי מסודר, יעיל ובטוח.',
                criteria: 'התשובה צריכה לכלול: מספר יציאות, רצף פינוי לוגי, תפקידים למבוגרים, נקודת התכנסות'
            },
            {
                id: 'data_analysis',
                title: '📈 ניתוח נתונים אקדמיים',
                description: 'פנחס מסתכל על הציונים האחרונים: 85% הצלחה במתמטיקה, 72% באנגלית, 91% בעברית, ו-78% במדעים. נתחו את הנתונים הללו ותנו המלצה מרכזית אחת לשיפור הביצועים.',
                criteria: 'התשובה צריכה לכלול: ניתוח של הפערים, זיהוי הבעיה העיקרית, המלצה מעשית וברורה'
            },
            {
                id: 'quotes',
                title: '💰 השוואת הצעות מחיר',
                description: 'פנחס קיבל 3 הצעות מחיר למחשבים חדשים: חברה א\' - 3000₪ (מחשב בסיסי + אחריות שנה), חברה ב\' - 3200₪ (מחשב מתקדם + אחריות שנתיים), חברה ג\' - 2800₪ (מחשב משומש + אחריות 6 חודשים). תנו המלצה מנומקת.',
                criteria: 'התשובה צריכה לכלול: השוואת יתרונות וחסרונות, המלצה ברורה, נימוק כלכלי או טכני'
            },
            {
                id: 'student_search',
                title: '🔍 חיפוש פרטי תלמידים',
                description: 'הורה בטלפון מחפש בדחיפות את פרטי הקשר של המורה הכיתה של בנו, יוסי כהן מכיתה ז\'2. פנחס לא מוצא את הפרטים במערכת המבולגנת שלו. איך תמצאו את המידע הדרוש?',
                criteria: 'התשובה צריכה לכלול: שלבים לוגיים לחיפוש, מערכות רלוונטיות לבדיקה, פרטי קשר דמיוניים של המורה'
            },
            {
                id: 'lesson_plans',
                title: '📚 כתיבת מערכי שיעור',
                description: 'המורה למדעים חולה באופן פתאומי ופנחס צריך לכתוב מערך שיעור חלופי בזמן קצר. כתבו מערך שיעור מעניין ויעיל של 45 דקות בנושא "כוח הכבידה" לתלמידי כיתה ו\'.',
                criteria: 'התשובה צריכה לכלול: 3-4 פעילויות שונות, ציון זמנים, התאמה לגיל, מטרות למידה'
            },
            {
                id: 'human_interactions',
                title: '🤝 תקשורת עם תלמידים',
                description: 'תלמיד מתלונן בפני פנחס שהוא משועמם מאוד בכל השיעורים ושוקל ברצינות לעזוב את בית הספר. איך פנחס צריך להגיב בצורה מקצועית ומועילה?',
                criteria: 'התשובה צריכה לכלול: הקשבה אמפתית, שאלות מבהירות, הצעות פתרון, מעורבות של גורמים נוספים'
            },
            {
                id: 'meetings',
                title: '🏛️ ארגון ישיבות',
                description: 'פנחס צריך לארגן ישיבת חירום של 30 דקות עם כל המורים בנושא דחוף: שיפור הציונים הנמוכים. הכינו סדר יום יעיל עם 4 נושאים מרכזיים שיש לדון בהם.',
                criteria: 'התשובה צריכה לכלול: 4 נושאים רלוונטיים, חלוקת זמנים, מטרות ברורות לישיבה'
            },
            {
                id: 'noise_colleagues',
                title: '🔇 התמודדות עם הפרעות',
                description: 'פנחס מתקשה להתרכז בעבודתו החשובה בגלל קולגה שמדבר בטלפון בקול רם מאוד כל היום. המציאו 3 דרכים נימוסיות ויעילות להתמודד עם המצב הקשה הזה.',
                criteria: 'התשובה צריכה לכלול: 3 פתרונות מעשיים, גישה נימוסית, פתרונות הדרגתיים'
            },
            {
                id: 'procedures',
                title: '📋 הסברת נהלים',
                description: 'מורה חדש שהתקבל לעבודה שואל את פנחס איך להגיש בקשה לחומרי לימוד חדשים. פנחס צריך להסביר את התהליך המורכב ב-4 שלבים פשוטים וברורים.',
                criteria: 'התשובה צריכה לכלול: 4 שלבים ברורים ולוגיים, פרטים מעשיים, מידע על זמני תגובה'
            },
            {
                id: 'excel',
                title: '💻 בניית גיליונות אלקטרוניים',
                description: 'פנחס צריך ליצור טבלת אקסל מסודרת לניהול ציונים של 25 תלמידים ב-5 מקצועות שונים. תכננו את מבנה הטבלה המפורט (כותרות עמודות ושורות).',
                criteria: 'התשובה צריכה לכלול: כותרות עמודות הגיוניות, מבנה ארגון ברור, שדות לחישובים (ממוצעים)'
            },
            {
                id: 'lesson_components',
                title: '🧩 פיתוח רכיבי שיעור',
                description: 'פנחס צריך להכין 3 שאלות מחשבה מעמיקות ומעניינות לסיום שיעור על נושא "מחזור המים בטבע" לתלמידי כיתה ה\'.',
                criteria: 'התשובה צריכה לכלול: 3 שאלות ברמות חשיבה שונות, התאמה לגיל, עידוד חשיבה יצירתית'
            },
            {
                id: 'parent_teacher',
                title: '👨‍👩‍👧‍👦 שיחות עם הורים',
                description: 'פנחס צריך להכין היטב לשיחה חשובה עם הורה של תלמיד הסובל מקשיי קשב וריכוז משמעותיים. הכינו 3 נקודות מרכזיות ובונות לדיון המתוכנן.',
                criteria: 'התשובה צריכה לכלול: 3 נקודות ממוקדות, גישה חיובית ובונה, הצעות פעולה קונקרטיות'
            },
            {
                id: 'problem_solving',
                title: '🔧 פתרון בעיות דחופות',
                description: 'האסון הגדול! המחשב של פנחס קרס לחלוטין ויש לו שיעור חשוב מאוד בעוד בדיוק 5 דקות. מה הוא צריך לעשות? תכננו תכנית פעולה מהירה ויעילה.',
                criteria: 'התשובה צריכה לכלול: פתרונות מיידיים, תכנית גיבוי, מעורבות של אנשים נוספים, הערכת זמנים'
            },
            {
                id: 'supplier_calls',
                title: '☎️ שיחות עם ספקים',
                description: 'פנחס צריך להזמין ציוד חדש ומתקדם למעבדת הכימיה של בית הספר. הכינו רשימת 4 שאלות חשובות וחיוניות שהוא צריך לשאול את הספק.',
                criteria: 'התשובה צריכה לכלול: 4 שאלות רלוונטיות, מחירים ומפרטים, זמני אספקה, שירות לקוחות'
            }
        ];

        // 🔧 משתני מערכת
        let currentTask = null;
        let timerInterval = null;
        let timeLeft = 240; // 4 דקות בשניות
        let completedCount = 0;
        let isEvaluating = false;

        // 🌐 בדיקת חיבור לשרת
        async function checkServerConnection() {
            try {
                console.log('🔄 בודק חיבור לשרת...');
                const response = await fetch('/api/health');
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('serverStatus').innerHTML = '🟢 AI מחובר ומוכן';
                    document.getElementById('serverStatus').className = 'server-status';
                    console.log('✅ שרת זמין:', data);
                } else {
                    throw new Error(`שרת החזיר סטטוס: ${response.status}`);
                }
            } catch (error) {
                console.error('❌ שגיאת חיבור לשרת:', error);
                document.getElementById('serverStatus').innerHTML = '🔴 שרת לא זמין';
                document.getElementById('serverStatus').className = 'server-status offline';
            }
        }

        // 🔄 בדיקה תקופתית של חיבור השרת
        setInterval(checkServerConnection, 30000);
        checkServerConnection(); // בדיקה ראשונית

        // 🎮 התחלת המשחק
        function startGame() {
            console.log('🎮 מתחיל משחק');
            document.getElementById('intro').style.display = 'none';
            showTasks();
        }

        // 📋 הצגת המשימות
        function showTasks() {
            console.log('📋 מציג משימות');
            document.getElementById('gameScreen').style.display = 'block';
            createTasksGrid();
            updateProgress();
        }

        // 🏗️ יצירת רשת המשימות
        function createTasksGrid() {
            const grid = document.getElementById('tasksGrid');
            grid.innerHTML = '';
            
            tasks.forEach((task, index) => {
                const taskCard = document.createElement('div');
                taskCard.className = 'task-card';
                taskCard.innerHTML = `
                    <h4>${task.title}</h4>
                    <p>לחץ כדי להתחיל במשימה</p>
                `;
                taskCard.onclick = () => openTask(task);
                taskCard.id = `task-${task.id}`;
                grid.appendChild(taskCard);
            });
            
            console.log(`✅ נוצרו ${tasks.length} משימות`);
        }

        // 📂 פתיחת משימה
        function openTask(task) {
            const taskCard = document.getElementById(`task-${task.id}`);
            
            // בדיקה אם המשימה כבר הושלמה או נכשלה
            if (taskCard.classList.contains('completed') || taskCard.classList.contains('failed')) {
                console.log(`⚠️ משימה ${task.id} כבר הושלמה/נכשלה`);
                return;
            }
            
            console.log(`📂 פותח משימה: ${task.title}`);
            currentTask = task;
            
            // מילוי פרטי המשימה
            document.getElementById('taskTitle').textContent = task.title;
            document.getElementById('taskDescription').textContent = task.description;
            document.getElementById('answerInput').value = '';
            document.getElementById('result').innerHTML = '';
            
            // איפוס הטיימר
            timeLeft = 240;
            startTimer();
            
            // הצגת המודל
            document.getElementById('taskModal').style.display = 'block';
        }

        // ⏰ התחלת הטיימר
        function startTimer() {
            console.log('⏰ מתחיל טיימר - 4 דקות');
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                // אזהרה בדקה האחרונה
                if (timeLeft <= 60 && timeLeft > 0) {
                    document.getElementById('timer').classList.add('warning');
                }
                
                // זמן נגמר
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    failTask('⏰ הזמן נגמר! מר פנחס אומר: "ראיתי שזה לא יעבוד! הטכנולוגיה רק מאטה אותנו!"');
                }
            }, 1000);
        }

        // 🔄 עדכון תצוגת הטיימר
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timer').textContent = `⏰ זמן נותר: ${timeString}`;
        }

        // ❌ סגירת המודל
        function closeModal() {
            console.log('❌ סוגר מודל');
            clearInterval(timerInterval);
            document.getElementById('taskModal').style.display = 'none';
            document.getElementById('timer').classList.remove('warning');
            isEvaluating = false;
            document.getElementById('checkBtn').disabled = false;
        }

        // 🔍 בדיקת התשובה
        async function checkAnswer() {
            if (isEvaluating) {
                console.log('⚠️ כבר בתהליך בדיקה');
                return;
            }
            
            const answer = document.getElementById('answerInput').value.trim();
            
            // בדיקות בסיסיות
            if (!answer) {
                alert('אנא כתבו תשובה לפני הבדיקה');
                return;
            }

            if (answer.length < 20) {
                showFailure({
                    feedback: 'מר פנחס: "זה הכל? אני צריך הרבה יותר פרטים כדי להבין איך AI יכול לעזור לי!"',
                    details: 'התשובה קצרה מדי - לפחות 20 תווים נדרשים'
                });
                return;
            }

            console.log(`🔍 בודק תשובה למשימה: ${currentTask.title}`);
            console.log(`📝 אורך תשובה: ${answer.length} תווים`);

            // מניעת לחיצות כפולות
            isEvaluating = true;
            document.getElementById('checkBtn').disabled = true;

            // בדיקה עם AI
            const result = await evaluateAnswer(currentTask, answer);
            
            if (result.success) {
                clearInterval(timerInterval);
                completeTask(result);
            } else {
                showFailure(result);
            }
            
            isEvaluating = false;
            document.getElementById('checkBtn').disabled = false;
        }

        // 🤖 הערכת התשובה עם AI
        async function evaluateAnswer(task, answer) {
            try {
                // הצגת הודעת טעינה
                document.getElementById('result').innerHTML = `
                    <div style="text-align: center; padding: 25px; background: #f8f9fa; border-radius: 10px;">
                        <div class="loading-spinner"></div>
                        <p style="margin: 0; color: #667eea; font-weight: bold;">
                            מר פנחס בודק את התשובה עם AI חכם...
                        </p>
                        <p style="margin: 5px 0 0 0; font-size: 14px; color: #999;">
                            זה יכול לקחת מספר שניות
                        </p>
                    </div>
                `;

                console.log('🤖 שולח לAI לבדיקה...');

                // קריאה לשרת
                const response = await fetch('/api/evaluate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        task: task,
                        answer: answer
                    })
                });

                console.log('🔄 סטטוס תגובה:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('❌ שגיאת שרת:', errorText);
                    throw new Error(`שגיאת שרת: ${response.status}`);
                }

                const result = await response.json();
                console.log('✅ תגובה מהAI:', result);
                
                // בדיקת תקינות התגובה
                if (typeof result !== 'object' || result === null) {
                    console.error('❌ תגובה לא תקינה:', result);
                    throw new Error('תגובה לא תקינה מהשרת');
                }
                
                return result;

            } catch (error) {
                console.error('❌ שגיאה בבדיקת התשובה:', error);
                return {
                    success: false,
                    feedback: '🔧 מר פנחס: "המחשב שלי שוב לא עובד כמו שצריך! אולי זו בדיוק הסיבה למה אני לא אוהב טכנולוגיה... נסה שוב!"',
                    details: `שגיאת חיבור: ${error.message}`
                };
            }
        }

        // ✅ השלמת משימה בהצלחה
        function completeTask(result) {
            console.log('✅ משימה הושלמה בהצלחה');
            
            const taskCard = document.getElementById(`task-${currentTask.id}`);
            taskCard.classList.add('completed');
            taskCard.innerHTML = `
                <h4>${currentTask.title}</h4>
                <p>✅ הושלם בהצלחה!</p>
            `;
            
            completedCount++;
            updateProgress();
            
            // הצגת התוצאה
            let feedbackHtml = `<div class="result success">${result.feedback}</div>`;
            if (result.details) {
                feedbackHtml += `<div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 8px; font-size: 14px; color: #2d5a2d;"><strong>פרטים נוספים:</strong> ${result.details}</div>`;
            }
            
            document.getElementById('result').innerHTML = feedbackHtml;
                
            // סגירה אוטומטית אחרי זמן
            setTimeout(() => {
                closeModal();
                if (completedCount === tasks.length) {
                    showFinalSuccess();
                }
            }, 5000);
        }

        // ❌ כישלון במשימה
        function failTask(message) {
            console.log('❌ משימה נכשלה');
            
            const taskCard = document.getElementById(`task-${currentTask.id}`);
            taskCard.classList.add('failed');
            taskCard.innerHTML = `
                <h4>${currentTask.title}</h4>
                <p>❌ נכשל - ניתן לנסות שוב</p>
            `;
            
            document.getElementById('result').innerHTML = `
                <div class="result failure">${message}</div>
            `;
                
            setTimeout(() => {
                closeModal();
            }, 4000);
        }

        // ⚠️ הצגת כישלון
        function showFailure(result) {
            console.log('⚠️ תשובה לא מספקת');
            
            let feedbackHtml = `<div class="result failure">${result.feedback}</div>`;
            if (result.details) {
                feedbackHtml += `<div style="margin-top: 15px; padding: 10px; background: #ffe8e8; border-radius: 8px; font-size: 14px; color: #8b0000;"><strong>מה לשפר:</strong> ${result.details}</div>`;
            }
            document.getElementById('result').innerHTML = feedbackHtml;
        }

        // 📊 עדכון התקדמות
        function updateProgress() {
            const total = tasks.length;
            const percentage = Math.round((completedCount / total) * 100);
            
            document.getElementById('completedTasks').textContent = completedCount;
            document.getElementById('totalTasks').textContent = total;
            
            console.log(`📊 התקדמות: ${completedCount}/${total} (${percentage}%)`);
        }

        // 🎉 סיום המשחק בהצלחה
        function showFinalSuccess() {
            console.log('🎉 משחק הושלם בהצלחה!');
            
            const finalMessage = `
🎉 מדהים! השגתם הישג נדיר!

עזרתם למר פנחס נחליאלי לגלות את הכוח האמיתי של AI!

💬 מר פנחס אומר:
"אני פשוט לא מאמין! כל השנים האלה שהתנגדתי לטכנולוגיה... 
AI באמת יכול לעזור לי להיות יעיל יותר ולחסוך זמן יקר!
תודה שלימדתם אותי שטכנולוגיה היא לא אויב - היא שותף!"

📈 תוצאות:
✅ משימות שהושלמו: ${completedCount}/${tasks.length}
🤖 AI עזר בכל הבדיקות
⏱️ חיסכון זמן עתידי: אינסופי!

מר פנחס עכשיו מאמין ב-AI ומוכן להשתמש בו בעבודתו היומיומית! 🚀
            `;
            
            alert(finalMessage);
        }

        // 🚀 הפעלה ראשונית
        console.log('🚀 מערכת מר פנחס מוכנה לפעולה!');
    </script>
</body>
</html>